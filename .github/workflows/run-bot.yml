name: Minecraft Keep-Alive Bot 24/7

on:
  workflow_dispatch:  # Manual trigger
  schedule:
    - cron: '0 */5 * * *'  # Runs every 5 hours (keeps under 6-hour limit)

jobs:
  run-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 295  # 4 hours 55 minutes (safety margin)
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: Install dependencies
      run: npm install
      
    - name: Run Minecraft Keep-Alive Bot
      run: |
        echo "==========================================="
        echo "üöÄ STARTING MINECRAFT KEEP-ALIVE BOT"
        echo "==========================================="
        echo "üìç Server: aglaea.mcserverhost.com:10534"
        echo "üë§ Bot name: KeepAliveBot"
        echo "‚è∞ Session duration: 4 hours 55 minutes"
        echo "üîÑ Next session: 5 minutes after this ends"
        echo "ü§ñ Bot will:"
        echo "   1. Connect to server on port 10534"
        echo "   2. Auto-reconnect if disconnected"
        echo "   3. Perform anti-AFK movements"
        echo "   4. Keep server active 24/7"
        echo "==========================================="
        
        # Start both bot and keep-alive server
        echo "Starting keep-alive server..."
        node keep_alive.js &
        
        echo "Starting Minecraft bot..."
        # Run bot for 4h 54m (leaving 1 minute buffer)
        timeout 294m node index.js
        
        echo "==========================================="
        echo "‚è∞ Session complete. Next run in ~5 minutes"
        echo "‚úÖ Server was kept active for 4h 55m"
        echo "==========================================="
